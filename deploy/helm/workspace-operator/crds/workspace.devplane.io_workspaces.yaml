---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.17.3
  name: workspaces.workspace.devplane.io
spec:
  group: workspace.devplane.io
  names:
    kind: Workspace
    listKind: WorkspaceList
    plural: workspaces
    shortNames:
    - ws
    singular: workspace
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: Workspace is the Schema for the workspaces API.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: WorkspaceSpec defines the desired state of a Workspace.
            properties:
              aiConfig:
                description: AIConfig configures the AI coding assistant (OpenAI-compatible
                  LLM endpoint).
                properties:
                  egressNamespaces:
                    description: |-
                      EgressNamespaces lists Kubernetes namespaces where LLM services run.
                      NetworkPolicy egress rules allow traffic to all pods in these namespaces.
                    items:
                      type: string
                    type: array
                  egressPorts:
                    description: |-
                      EgressPorts lists TCP ports allowed for egress to external IPs (0.0.0.0/0).
                      Use this to allow git over SSH (22), package registries (5000, 8080, 8081),
                      bare-metal LLM endpoints (8000, 11434), and any other non-standard ports.
                      If empty, the operator default or built-in default list is used.
                    items:
                      format: int32
                      type: integer
                    type: array
                  endpoint:
                    description: |-
                      Endpoint is the base URL of the OpenAI-compatible LLM service
                      (e.g., "http://vllm.ai-system.svc:8000", "http://ollama.ai-system.svc:11434").
                    type: string
                  model:
                    description: Model is the model identifier (e.g., "deepseek-coder-33b-instruct").
                    type: string
                required:
                - endpoint
                - model
                type: object
              persistence:
                description: Persistence configures storage class for the workspace
                  PVC.
                properties:
                  storageClass:
                    description: StorageClass is the name of the StorageClass for
                      the workspace PVC.
                    type: string
                type: object
              resources:
                description: Resources defines CPU, memory, and storage for the workspace
                  pod.
                properties:
                  cpu:
                    description: CPU limit (e.g., "2").
                    type: string
                  memory:
                    description: Memory limit (e.g., "4Gi").
                    type: string
                  storage:
                    description: Storage size for the workspace PVC (e.g., "20Gi").
                    type: string
                required:
                - cpu
                - memory
                - storage
                type: object
              tls:
                description: TLS configures custom TLS certificate trust for the workspace.
                properties:
                  customCABundle:
                    description: |-
                      CustomCABundle references a ConfigMap containing CA certificates.
                      All keys will be mounted into the pod's trust store.
                    properties:
                      name:
                        description: Name of the ConfigMap containing CA certificates.
                        type: string
                    required:
                    - name
                    type: object
                type: object
              user:
                description: User identifies the workspace owner (from OIDC).
                properties:
                  email:
                    description: Email is the user's email from the OIDC token.
                    type: string
                  id:
                    description: ID is the sanitized username (e.g., "john").
                    type: string
                required:
                - email
                - id
                type: object
            required:
            - aiConfig
            - persistence
            - resources
            - user
            type: object
          status:
            description: WorkspaceStatus defines the observed state of a Workspace.
            properties:
              lastAccessed:
                description: LastAccessed is when the workspace was last accessed
                  by the user.
                format: date-time
                type: string
              message:
                description: Message is a human-readable error or info (e.g. validation
                  failure, PVC not bound).
                type: string
              phase:
                description: 'Phase is the current lifecycle phase: Pending, Creating,
                  Running, Failed, Stopped.'
                type: string
              podName:
                description: PodName is the name of the workspace pod when running.
                type: string
              serviceEndpoint:
                description: ServiceEndpoint is the internal service DNS name for
                  the workspace.
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
